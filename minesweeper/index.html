<!DOCTYPE html>
<html>
<head>
    <style>
        body { display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; }
        #main-menu { text-align: center; }
        .difficulty-btn { margin: 10px; padding: 15px 30px; font-size: 18px; }
        #game-board { position: relative; }
        .cell { 
            width: 30px; 
            height: 30px; 
            border: 1px solid #999;
            display: inline-block;
            text-align: center;
            vertical-align: top;
            line-height: 30px;
            cursor: pointer;
            background: #ccc;
        }
        .revealed { background: #fff; }
        .mine { background: red !important; }
        .flag::after { content: "ğŸš©"; }
        .game-over { position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); }
        .result-panel { 
            position: fixed; 
            top: 50%; 
            left: 50%; 
            transform: translate(-50%, -50%);
            background: white;
            padding: 20px;
            text-align: center;
        }
        img.victory-img { max-width: 300px; max-height: 300px; }

        /* å¢åŠ ç»“æœé¢æ¿çš„æ ·å¼ */
        .result-panel {
            border: 2px solid gold;
            box-shadow: 0 0 20px rgba(0,0,0,0.3);
            border-radius: 10px;
        }

        /* æŒ‰é’®ç¾åŒ– */
        .result-panel button {
            margin: 10px;
            padding: 8px 20px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .result-panel button:hover {
            background: #45a049;
        }
    </style>
</head>
<body>
    <!-- ä¸»èœå• -->
    <div id="main-menu">
        <button class="difficulty-btn" data-difficulty="beginner">åˆçº§</button>
        <button class="difficulty-btn" data-difficulty="intermediate">ä¸­çº§</button>
        <button class="difficulty-btn" data-difficulty="expert">é«˜çº§</button>
    </div>

    <!-- æ¸¸æˆç•Œé¢ -->
    <div id="game-board" style="display: none;"></div>

    <!-- ç»“æœå¼¹çª— -->
    <div class="result-panel" style="display: none;">
        <!-- ç§»é™¤å›ºå®šå›¾ç‰‡ï¼Œæ”¹ä¸ºåŠ¨æ€åˆ›å»º -->
        <div id="result-content"></div>
        <div>
            <button onclick="backToMenu()">è¿”å›ä¸»é¡µ</button>
            <button onclick="restartGame()">é‡æ–°å¼€å§‹</button>
        </div>
    </div>
</body>

<script>
// åœ¨é…ç½®å¯¹è±¡ä¸­æ·»åŠ å›¾ç‰‡è·¯å¾„
let config = {
    beginner: { rows: 9, cols: 9, mines: 10 ,victoryImg: 'beginner-victory.jpg'},
    intermediate: { rows: 16, cols: 16, mines: 40,victoryImg: 'intermediate-victory.jpg' },
    expert: { rows: 16, cols: 30, mines: 99,victoryImg: 'expert-victory.jpg' }
};

let gameState = {
    board: [],
    mines: new Set(),
    flags: new Set(),
    revealed: new Set(),
    gameOver: false,
    firstClick: true
};

// åˆå§‹åŒ–æ¸¸æˆ
function initGame(difficulty) {
    const { rows, cols, mines } = config[difficulty];
    gameState = {
        board: Array(rows).fill().map(() => Array(cols).fill(0)),
        mines: new Set(),
        flags: new Set(),
        revealed: new Set(),
        gameOver: false,
        firstClick: true,
        difficulty,
        rows,
        cols,
        mines
    };
    
    document.getElementById('main-menu').style.display = 'none';
    document.getElementById('game-board').style.display = 'block';
    renderBoard();
}

// ç”Ÿæˆåœ°é›·ï¼ˆç¡®ä¿ç¬¬ä¸€æ¬¡ç‚¹å‡»å®‰å…¨ï¼‰
function generateMines(safeRow, safeCol) {
    const { rows, cols, mines } = gameState;
    const totalCells = rows * cols;
    const minesSet = new Set();
    
    while(minesSet.size < mines) {
        const r = Math.floor(Math.random() * rows);
        const c = Math.floor(Math.random() * cols);
        if(r !== safeRow || c !== safeCol) {
            minesSet.add(`${r},${c}`);
        }
    }
    
    gameState.mines = minesSet;
}

// è®¡ç®—å‘¨å›´åœ°é›·æ•°é‡
function calculateNumbers() {
    const { rows, cols } = gameState;
    for(let r = 0; r < rows; r++) {
        for(let c = 0; c < cols; c++) {
            if(!gameState.mines.has(`${r},${c}`)) {
                let count = 0;
                for(let dr = -1; dr <= 1; dr++) {
                    for(let dc = -1; dc <= 1; dc++) {
                        if(dr === 0 && dc === 0) continue;
                        const nr = r + dr;
                        const nc = c + dc;
                        if(nr >= 0 && nr < rows && nc >= 0 && nc < cols) {
                            if(gameState.mines.has(`${nr},${nc}`)) count++;
                        }
                    }
                }
                gameState.board[r][c] = count;
            }
        }
    }
}

// æ¸²æŸ“æ£‹ç›˜
function renderBoard() {
    const { rows, cols } = gameState;
    const board = document.getElementById('game-board');
    board.innerHTML = '';
    board.style.width = cols * 32 + 'px';

    for(let r = 0; r < rows; r++) {
        for(let c = 0; c < cols; c++) {
            const cell = document.createElement('div');
            cell.className = 'cell';
            cell.dataset.row = r;
            cell.dataset.col = c;
            
            if(gameState.revealed.has(`${r},${c}`)) {
                cell.classList.add('revealed');
                if(gameState.board[r][c] > 0) {
                    cell.textContent = gameState.board[r][c];
                }
            }
            
            if(gameState.flags.has(`${r},${c}`)) {
                cell.classList.add('flag');
            }

            cell.addEventListener('click', handleClick);
            cell.addEventListener('contextmenu', handleRightClick);
            board.appendChild(cell);
        }
    }
}

// å¤„ç†ç‚¹å‡»äº‹ä»¶
function handleClick(e) {
    if(gameState.gameOver) return;
    const row = parseInt(e.target.dataset.row);
    const col = parseInt(e.target.dataset.col);
    
    if(gameState.firstClick) {
        generateMines(row, col);
        calculateNumbers();
        gameState.firstClick = false;
    }
    
    reveal(row, col);
}

// é€’å½’æ­ç¤ºåŒºåŸŸ
function reveal(r, c) {
    if(gameState.flags.has(`${r},${c}`) || 
       gameState.revealed.has(`${r},${c}`)) return;

    gameState.revealed.add(`${r},${c}`);
    
    if(gameState.mines.has(`${r},${c}`)) {
        gameOver(false);
        return;
    }

    if(gameState.board[r][c] === 0) {
        for(let dr = -1; dr <= 1; dr++) {
            for(let dc = -1; dc <= 1; dc++) {
                const nr = r + dr;
                const nc = c + dc;
                if(nr >= 0 && nr < gameState.rows && 
                   nc >= 0 && nc < gameState.cols) {
                    reveal(nr, nc);
                }
            }
        }
    }

    checkWin();
    renderBoard();
}

// å¤„ç†å³é”®äº‹ä»¶ï¼ˆæ’æ——ï¼‰
function handleRightClick(e) {
    e.preventDefault();
    if(gameState.gameOver) return;
    
    const row = e.target.dataset.row;
    const col = e.target.dataset.col;
    const key = `${row},${col}`;
    
    if(gameState.flags.has(key)) {
        gameState.flags.delete(key);
    } else {
        gameState.flags.add(key);
    }
    
    renderBoard();
}

// æ¸¸æˆç»“æŸå¤„ç†
function gameOver(won) {
    gameState.gameOver = true;
    const panel = document.querySelector('.result-panel');
    const content = document.getElementById('result-content');
    
    content.innerHTML = won ? 
        `<img src="${config[gameState.difficulty].victoryImg}" class="victory-img">` : 
        '<h2>æ¸¸æˆå¤±è´¥ï¼</h2>';
    
    panel.style.display = 'block';
}

// é‡æ–°å¼€å§‹å‡½æ•°
function restartGame() {
    document.querySelector('.result-panel').style.display = 'none';
    initGame(gameState.difficulty);
}

// è¿”å›ä¸»èœå•
function backToMenu() {
    document.getElementById('main-menu').style.display = 'block';
    document.getElementById('game-board').style.display = 'none';
    document.querySelector('.result-panel')?.remove();
}

// æ£€æŸ¥æ˜¯å¦èƒœåˆ©
function checkWin() {
    const { rows, cols, mines } = gameState;
    const totalSafe = rows * cols - mines.size;
    if(gameState.revealed.size === totalSafe) {
        gameOver(true);
    }
}

// ç»‘å®šéš¾åº¦æŒ‰é’®äº‹ä»¶
document.querySelectorAll('.difficulty-btn').forEach(btn => {
    btn.addEventListener('click', () => {
        initGame(btn.dataset.difficulty);
    });
});
</script>
</html>